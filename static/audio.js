/* VARIOUS TRACK LISTS ARE STORED HERE FOR TESTING PURPOSES */

var trackListArray = ['Africa - Caspa & Rusko.mp3', 'Afroman - Because I Got High.mp3', 'Alex Gaudino vs Fedde le Grand - Hands Out.mp3', 'aphex twin - come to daddy.mp3', 'Attack Attack - Set The Sun (Klaas Mix).mp3', 'Bad Company - Planet Dust.mp3', 'Benga - Crunked Up.mp3', 'Blasta - Dub like no other.mp3', 'Booka Shade vs MANDY - body language.mp3', 'BOOM BYE BATTY BOY - DUB.mp3', 'Brockie & Ed Solo - System Check (G-Dub Remix).mp3', 'Buju Banton - Batty Rider.mp3', 'Caspa & Rusko - Bread Get Bun.mp3', 'Caspa & The Others - Well `Ard.mp3', 'Clouds - Mighty Eyeball Rays.mp3', 'Cotti & Cluekid - Sensi Dub.mp3', 'Crookers - Il Brutto (Bloody Beetroots Il Bruttissimo Remix).mp3', 'CROOKERS - MAD KIDZ.mp3', 'Crookers - We are Prostitutes.mp3', 'Danny Byrd - Gold Rush (ft. Brookes Brothers).mp3', 'Dave Spoon ft Lisa Mafia - Bad Girl at Night.mp3', 'DIGITALISM - IDEALISTIC.mp3', "Distance - Fallen Vex'd Remix.mp3", 'Distance - Night Vision.mp3', 'Distance - No Sunshine.mp3', 'Distance - Traffic [Planet Mu].mp3', 'Distance - V.mp3', 'DJ Hazard - Use Your Brain.mp3', 'DJ Hype - Ready Or Not - Drum N Bass Remix.mp3', 'Dj Zinc - Ska (Rmx).mp3', 'DJ Zinc - The Creeper.mp3', 'Dub Alley - Vendetta.mp3', 'Dub Politicians - Sparta.mp3', 'Dubstep - Dank Dub.mp3', 'Dubtraction (MPI Project) - Empire X.mp3', 'F1 - Airbus.mp3', 'F1 And Kromestar - F1-007.mp3', 'Freaks - The Creeps ( Vandalism remix ).mp3', 'Fullness - Butterfish (Marlow Remix).mp3', 'G Dub - Forever VIP (Original Sin Remix).mp3', 'Gorillaz - Feel Good (Freeform Five Remix).mp3', 'Ian Carey - Keep on Rising (Dub Radio Mix).mp3', 'Jamdown - Ghetto relick.mp3', 'Justice ft Uffie - The Party.mp3', "Kid Cudi - Day 'N' Night (Crookers Remix).mp3", 'Kid Cudi - Man on the moon.mp3', 'Kiss kiss bang bang - High contrast.mp3', 'Kode 9 & Spaceape - 9 Samurai.mp3', 'Kosheen - All In My Head (Technical Itch Remix).mp3', 'Kosheen - Harder (Technical Itch Remix).mp3', 'Lil Wayne - Hummin.mp3', 'Majistrate - Yeti Muncher(g-dub remix).mp3', 'Movado - Gangsta for life (Coki Remix).mp3', 'N-Type & Loefah - Way Of The Dub (Caspa Remix).mp3', 'Noel Sinner - Pull Over (Dabruck And Klein Mix).mp3', 'Nutone - System (Matrix and Futurebound Remix).mp3', 'Optimus & Droid - Area.mp3', 'Optimus & Droid - Dublin Traffic.mp3', 'Original Sin - Dont Be Silly.mp3', 'Original Sin - Skanknasty.mp3', 'paragon9x - Chaoz Devotion.mp3', 'paragonx9 remix.mp3', 'Prodigy - Breathe.mp3', 'Psychonaught - Dread Bread Stonjah.mp3', 'RAkoon - Barry.mp3', 'Rave Allstars - The Logical Song (Rave Club Mix).mp3', 'Redeyes - Hold Tight.mp3', 'Robot Needs Oil - Volta (Olivier Giacomotto remix).mp3', 'Royksopp - What Else is There (Trentemoller remix).mp3', 'Rusko - Cockney Thug.mp3', 'Sarantis - Meditation.mp3', 'SebastiAn - Killing In The Name Of Sebastian (remix).mp3', 'Shiny Toy Guns - Le disko (Boys Noize Vocal remix).mp3', 'Shut Up And Dance - Outta National (Taxman Remix).mp3', 'Shy FxRay Keith - Chopper.mp3', 'Skream - Tapped.mp3', 'SPL - Deus Ex Machina.mp3', 'Subscape - Badman.mp3', 'Subscape - Transaction.mp3', 'TC - Drink(xample remix).mp3', "TC - Where's My Money (Caspa Remix).mp3", 'Technical Itch - Reborn (Weapon Remix).mp3', 'Temperature - BB - DNB.mp3', 'Tes La Rok - Bass 31.mp3', 'Tes La Rok - Cold Blooded.mp3', 'Tes La Rok - Gunshot.mp3', 'The Chemical Brothers - The Salmon Dance (Crookers WoW Mix).mp3', 'The Klaxons - Not Over Yet (Skream remix).mp3', 'The Others - Bed Bugz.mp3', 'The Others - Flap Jack.mp3', 'The Prodigy - Out of Space.mp3', 'The Rapture - Get Myself Into It (Sebastian Mix).mp3', 'The Salmon Dance - Crookers.mp3', "Three 6 Mafia ft. Akon & Jim Jones - That's Right [Dirty].mp3", 'Timbaland - The Way I Are (Zya & Badal Electro Remix).mp3', 'Tracey Thorn - Grand Canyon (Dirty South Remix).mp3', 'TRG - Hoods Up.mp3', 'uffie - Pop the Glock.mp3', 'Uncle Sam - Round The World Girls (Tes La Rok Remix) .mp3', 'Vital Elements - No Getting Out.mp3', 'We Built This - Potential Bad Boy Remarc and MC Eksman.mp3', 'Wolf Man - The Kraken.mp3', 'Xample & Lomax - Contra.mp3', 'Young Jeezy - Put On (Ft. Kanye West).mp3']

var trackListArray2 = ['01 Hungry Ham (Kayzo Edit).mp3', '02 Blur — Song 2 (Madeon Remix).mp3', '03 Keep Pushin’ (Purple Disco Machine Vox Mix).mp3', '01 Millionaire (JayKode Remix).mp3', '04 Hypnotic.mp3', '06 Dancing People Are Never Wrong (Original Mix).mp3', '09 No Reason (Original Mix).mp3', '10 Low.mp3', '11 I.O.U. (feat. Emeli Sandé).mp3', '08 Riggi & Piros - Tribe.mp3', '07 Blur - Song 2.mp3']

var albumTitle1 = "Various Artists - Deep Balearic House Music Vol.1 (2016) MP3"

var album1TrackList = ['01. Mario Chris - By Your Side.mp3', '02. Krokodile Kruegel - Fog in the Moonlight.mp3', '03. Just Karl - Use It.mp3', '04. 9Ball - Flowstone Salamander.mp3', '05. Marcimo - Time.mp3', '06. Nx$ - On Fire.mp3', '07. Yanter - 1 Two Go!.mp3', '08. Sumak - The Way You Move.mp3', '09. Jorgee Ochoa - The Perfect Life.mp3', '10. Robert Feelgood & Miss Sugaware - There Are so Many People.mp3', '11. Aly Omar - The Legend.mp3', '12. G-Mode - Back Level (Chris Decent Remix).mp3', '13. Sascha Beek - Vanity.mp3', '14. G-Mode - Get the Funky (Ozgur Uzar Mix).mp3', '15. Uffe Bengtsson - Open Your Heart.mp3', '16. Schaller - Come.mp3', '17. Chris Decent - Subway Blues (Gary Teo Remix).mp3', '18. Noctiluca - Volver (Zak Gee Remix).mp3', '19. Profundo - Organic (Profundo & Gomes Rework).mp3', '20. Dimix & Natalie Major - Coming Alive (Fallow Dub Mix).mp3', '21. Dr. Beat - Pretty Lady.mp3', '22. Miguel Alcobia - Sonar.mp3', '23. Mr. Groove - Place Where You Belong.mp3', "24. Dan McKie - The Messiah's Birthday.mp3", '25. Just Dennis - Do It Now.mp3']

var album1BPMList = [118.0, 125.0, 122.0, 125.0, 121.0, 123.0, 122.0, 122.0, 123.0, 122.0, 126.0, 118.0, 124.0, 124.0, 120.0, 115.0, 125.0, 118.0, 123.0, 124.0, 120.0, 124.0, 122.0, 123.0, 124.0];

var album2TrackListp1 = ['54 feat Nashi - Disco Dancer (Steve Osaka Role Models Extended)_www.dj-case.com.mp3', 'Addy Van Der Zwan - Get Get Down 2010_www.dj-case.com.mp3', 'Alex M - Feel The Heat (Max K Remix)_www.dj-case.com.mp3', 'Amsterdam Avenue feat. Matteo - Mysterious Girl_www.dj-case.com.mp3', 'Andrew Spencer & The Vamprockerz - Zombie 2k10 (Max K. Remix)_www.dj-case.com.mp3', 'Anna Grace - Celebration (Firebeatz Remix)_www.dj-case.com.mp3', 'Antoine Clamaran feat Soraya - Live Your Dreams (Albert Neve Main Mix)_www.dj-case.com.mp3', 'AXER Vs Andreas Henneberg - Gringo 123 (Tristan Garner Bootleg)_www.dj-case.com.mp3', "Axwell & Sebastian Ingrosso - Together (Nash La'Salle Remix)_www.dj-case.com.mp3", 'Bart B More - Romane (Rubix Remix)_www.dj-case.com.mp3', 'Bassmonkeys - Bad 4 My Health (BM Elektromonkey Remix)_www.dj-case.com.mp3', 'Bastian Van Shield - Rock and Roll (BvS Alternative Mix)_www.dj-case.com.mp3', 'Benny Benassi feat Channing - Come Fly Away (Cherry Coke Remix)_www.dj-case.com.mp3', 'Biank - Flashing Lights (Deepside Deejays Remix)_www.dj-case.com.mp3', 'Bingo Players feat. Danthony - I Will Follow (Original Mix)_www.dj-case.com.mp3', 'Bob Sinclar - New New New_www.dj-case.com.mp3', 'Boogie Bros - Fight For Your Right (Crystal Rock Remix)_www.dj-case.com.mp3', 'Carl Kennedy, Tommy Trash - Blackwater feat Rosie Henshaw (Club Mix)_www.dj-case.com.mp3', 'Cevin Fisher, Prok & Fitch - Mundo (David Penn Dark Room Mix)_www.dj-case.com.mp3', 'Cheese People - I Just Can Shoot (Relanium Mix)_www.dj-case.com.mp3', 'Chocolate Puma - Back Home feat. Colonel Red (Original Mix)_www.dj-case.com.mp3', 'Christian Vila - Turn It Up (Original Mix)_www.dj-case.com.mp3', 'Christian Weber feat. Jay Rocves - Up (Tristan Garner Remix)_www.dj-case.com.mp3', 'Chuckie - Rock That Body (Original Mix)_www.dj-case.com.mp3', 'Criminal Vibes feat. Larry - Who Said (Original Criminal Mix)_www.dj-case.com.mp3', 'Cristian Marchi & Nari & Milani  feat. Luciana - I Got My Eye On You (Nari & Milani Club Mix)_www.dj-case.com.mp3', 'Cristian Marchi & Nari & Milani feat. Luciana - I Got My Eye On You (Cristian Marchi & Paolo Sandini Perfect Mix)_www.dj-case.com.mp3', 'Cuca From Brazil - Happy Face (Face Mask Mix)_www.dj-case.com.mp3', 'Dabruck & Klein - Cars (Tommy Trash Remix)_www.dj-case.com.mp3', "Danie Bovie & Roy Rox ft. Nelson - Love Me (ATFC's Soultek Vocal Mix)_www.dj-case.com.mp3", 'Daniel Portman - Hells Kitchen_www.dj-case.com.mp3', 'Daniel Portman - Plastic Society (Original Mix)_www.dj-case.com.mp3', 'Daniele Sorrenti - Cyborg (Original Mix)_www.dj-case.com.mp3', 'Dataworx - Control_www.dj-case.com.mp3', 'David Amo & Julio Navas, Andrea B. - Nervioso_www.dj-case.com.mp3', 'Deadmau5 - Hi-Friend_www.dj-case.com.mp3', 'Deadmau5 - More Ghosts and Whatever_www.dj-case.com.mp3', 'Degrees of Motion vs Mark Wilkinson - Shine On_www.dj-case.com.mp3', 'Dennis Ferrer - Hey Hey (Incognet Remix)_www.dj-case.com.mp3', 'Dennis Ferrer - Hey Hey (Vandalism Remix)_www.dj-case.com.mp3', 'Dirty Laundry - Hate Me (Arno Cost Remix)_www.dj-case.com.mp3', 'Dizzee Rascal and Armand Van Helden (Bonkers Club Mix)_www.dj-case.com.mp3', "DJ Disciple - When I Die (Disciple's Le Souk NYC Mix)_www.dj-case.com.mp3", 'DJ Fenix feat. Shayon - Lambada 2010 (Original mix)_www.dj-case.com.mp3', 'Dks - Sing With a Swing (Raf Marchesini Remix)_www.dj-case.com.mp3', 'Dr Kucho - Just Be Good To Me_www.dj-case.com.mp3', 'Dr. Kucho! - Do You Want To (Beat & Bleep Mix)_www.dj-case.com.mp3', 'Eddie Thoneick ft Terri B - Release (Bingo Players Remix)_www.dj-case.com.mp3', 'Fake Blood - I Think I Like It (Extended Mix)_www.dj-case.com.mp3', 'Fedde Le Grand and Mr V - Back and Forth (Full Vocal Mix)_www.dj-case.com.mp3', 'Fedde Le Grand feat. Mr. V - Back And Forth (Feddes Future Funk Remix)_www.dj-case.com.mp3', 'Fedde Le Grand mr. V vs Super Mal Lifelike - Bigger than back forth (De Leo bootleg)_www.dj-case.com.mp3', 'Felguk feat. Sporty O - 2nite (Original Mix)_www.dj-case.com.mp3', 'Fly Project - Mandala (Deepside Deejays Rmx)_www.dj-case.com.mp3', 'Fudge X - Wait 4 U (Paolo Armani Electro Disco Extended)_www.dj-case.com.mp3', 'Geo Da Silva Ft. Tony Ray - I Like The Girls Who Drink With Me (Externded Version)_www.dj-case.com.mp3', 'Groovenatics- Astroidz (Original Mix)_www.dj-case.com.mp3', 'Hell Ektik - Mumbai (Original Mix)_www.dj-case.com.mp3', "Horny United - Nobody (If I Can't Have You) (Boogee Brotherz Mix)_www.dj-case.com.mp3", 'House Rockerz Feat. Unter Druck - Nur Tanzen! (Club Mix)_www.dj-case.com.mp3', 'Hoxton Whores - Devil Toy (Main Mix)_www.dj-case.com.mp3', "Inaya Day & Nick Jay - All I'm Sayin', Just Hold On (Nathan C Remix)_www.dj-case.com.mp3", 'Inna - 10 Minutes (Play & Win Club Mix)_www.dj-case.com.mp3', 'Inusa Dawuda & DJ Chick - We Want More (Makhno Project Extended Mix)_www.dj-case.com.mp3', 'Jamiroquai - Deeper Underground (DJ Denis Rublev & DeRom Remix)_www.dj-case.com.mp3', 'Jesse Garcia & Mishelle Weeks - Get Your Head Right (Original Mix)_www.dj-case.com.mp3', 'Jochen Pash & Norm - Watching You (Original Full Vocal mix)_www.dj-case.com.mp3', 'Jus Jack - That Sound (Deepside Deejays Extended Club Mix)_www.dj-case.com.mp3', 'Kaskade and Deadmau5 - Move for Me (Extended Mix)_www.dj-case.com.mp3', 'Kate Ryan - Babacar (Basto Remix)_www.dj-case.com.mp3', 'Keith - Macedonia (Original Mix)_www.dj-case.com.mp3', 'Kesha - Tik Tok (Giorgio Sainz Remix)_www.dj-case.com.mp3', 'Key 900 - Magic Love (Dub Makers remix)_www.dj-case.com.mp3', 'Klaas - Downtown (Spinnin Elements Remix)_www.dj-case.com.mp3', 'Little Boots - Remedy (Kaskade Club Remix)_www.dj-case.com.mp3']

var album2TrackListp2 = ['Mark Simmons - Get Us High (mark simmons main mix)_www.dj-case.com.mp3', 'Mark Trophy feat. Angela Brooks - A Deeper Love Pride 2010 (Jason Chance Remix)_www.dj-case.com.mp3', 'Marty Fame feat. Karmela - Unforgettable Incredible_www.dj-case.com.mp3', 'Mats & Alex Avenue - Make It Happen (Lanfranchi And Farina Remix)_www.dj-case.com.mp3', 'Matush - Party Time (Josh The Funky 1 Re-Work)_www.dj-case.com.mp3', 'Michael Mind - Gotta Let You Go (Dutch Mix)_www.dj-case.com.mp3', 'Michele Zani - S.O.N.I.A. (Andrea Bertolini Remix)_www.dj-case.com.mp3', 'Milk & Sugar feat. Ayak - Let The Love (Take Over) (Milk & Sugar Global Mix)_www.dj-case.com.mp3', 'Milton Channels, Sebastian Reza - Zutra (Firebeatz Remix)_www.dj-case.com.mp3', 'Moonbootica - Break Of Light_www.dj-case.com.mp3', 'Morris Corti and Eugenio Lamedica - Shake that body (Original mix)_www.dj-case.com.mp3', 'Nervo & Ollie James - This Kind Of Love (Nari & Milani Remix)_www.dj-case.com.mp3', 'Oscar Cano & Freddy Marquez - Are You Gonna Go My Way 2010_www.dj-case.com.mp3', 'Pacific Vandyck ft. Vicky Fee - Making Me Dirty_www.dj-case.com.mp3', 'Paul Gardner and Hugh Gunnell feat Marcella Woods - Come Get My Lovin (Mish Mash Mix)_www.dj-case.com.mp3', 'Pharrel Williams - Add Suv (Armand Van Helden Vocal Remix)_www.dj-case.com.mp3', 'Phil Fuldner - Miami Pop 2010 (Original Extended Mix)_www.dj-case.com.mp3', 'Planet Funk - Lemonade (Benny Benassi Remix)_www.dj-case.com.mp3', 'Prok and Fitch pres. Nanchang Nancy - Walk With Me (Axwell vs Daddys Groove Remix)_www.dj-case.com.mp3', 'Pryda - Miami To Atlanta_www.dj-case.com.mp3', 'Put it St!CKY feat. Ruby Rhythm - Artistic Raw Remix_www.dj-case.com.mp3', 'Redroche feat, Laura Kidd - Give U More (Sebastien Drums & Rob Adans Mix)_www.dj-case.com.mp3', "Rihanna - Rude Boy (Chew Fu's Bumbaclot Fix)_www.dj-case.com.mp3", 'Rihanna - Rude Boy (GrooveshakerZ Remix)_www.dj-case.com.mp3', 'Rivaz feat Laurent N - Everybody Dance (Original Mix)_www.dj-case.com.mp3', 'Robert Owens - Deep Down (Chocolate Puma Main Mix)_www.dj-case.com.mp3', 'Rolvario vs. Afrojack - Now The Party Starts (Original Mix)_www.dj-case.com.mp3', 'Sander van Doorn - Riff (Original Mix)_www.dj-case.com.mp3', 'Sanders, Deenasty -Te Quiero Perra (Slin Project Electrofunk Remix)_www.dj-case.com.mp3', 'Sandy Vee feat. Robin S. - Straight To The Sky (Nicky Romero Remix)_www.dj-case.com.mp3', 'Sebastien Drums & Avicii - My Feeling For You (Digital Lab Remix)_www.dj-case.com.mp3', 'Sebastien Drums & Avicii - My Feeling For You (Original Mix)_www.dj-case.com.mp3', 'Sebastien Leger - Balkamaniac_www.dj-case.com.mp3', 'Sem Thomasson & Xavez - Balkan Snow (Sebastien Lintz & Rene Kupper Remix)_www.dj-case.com.mp3', 'Serge Devant - Addicted_www.dj-case.com.mp3', 'Sidney Samson feat. Lady Bee - Shut Up & Let It Go (Bass Kleph Remix)_www.dj-case.com.mp3', 'Simone Totosano feat Janet Gray - Fantasy Moon Light (Extended Original Mix)_www.dj-case.com.mp3', 'Sonique - World Of Change (Costi.ro Remix)_www.dj-case.com.mp3', 'Squeeze - Doop (Club Mix)_www.dj-case.com.mp3', 'Starborn - Bad (Noll and Kliwer fat monster mix).mp3', 'Starborn - Bad (Noll and Kliwer fat monster mix)_www.dj-case.com.mp3', 'Starchild and Sunrise Inc - Lick Shot (Extended Mix)_www.dj-case.com.mp3', 'Stereo Palma - Andale (Nicola Fasano, Steve Forest South Beach Mix)_www.dj-case.com.mp3', 'Stromae - Alors on Danse (extended mix)_www.dj-case.com.mp3', 'Sub Focus - Could This Be Real_www.dj-case.com.mp3', 'Sven Gosch & Gerald Reichard feat. Aurelie - Music Took My Soul (Purple Project Remix)_www.dj-case.com.mp3', 'Takeshy Kurosawa Vs Gube - Wassup (Maurizio Gubellini Vs Sala and Peruz Remix)_www.dj-case.com.mp3', 'The Angry Kids, Bob Marley - Mr. Brown (Ian Carey Remix)_www.dj-case.com.mp3', 'The Good Guys feat Tesz Millan - Spotlight (Original Mix)_www.dj-case.com.mp3', 'The Subs - Mitsubitchi_www.dj-case.com.mp3', 'Thomas Gold vs. Matthias Menck - Sky (Nari & Milani Remix)_www.dj-case.com.mp3', "Tim Deluxe, Analog People in a Digital World - Just Won't Do  (ATFC & Warren Clarke Re-Vamp)_www.dj-case.com.mp3", 'Tim Sanchez - Can U Feel It (Dj Chick Crazy Mix)_www.dj-case.com.mp3', 'Timbaland feat. Katy Perry - If We Ever Meet Again (Chew Fu Remix)_www.dj-case.com.mp3', 'Tomcraft And Jerome Isma-Ae - Trouble In The Redlight District (Weekend Heroes Remix)_www.dj-case.com.mp3', 'Tommy Love - E-Rotic (Summer Mix)_www.dj-case.com.mp3', 'TV Rock feat Rudy - In The Air (Grum Remix)_www.dj-case.com.mp3', 'Tv Rock ft Rudy - In The Air (Axwell Remix)_www.dj-case.com.mp3', 'Two Door Cinema Club - Something Good Can Work (The Twelves Remix)_www.dj-case.com.mp3', 'Ultra Nate - Free (Teo Moss & Danie Shems Remix)_www.dj-case.com.mp3', 'Voodoo & Serano - You Get What You Give (Plastik Funk Remix)_www.dj-case.com.mp3', 'Watch The Club Go feat Mr Robotic (Original Mix)_www.dj-case.com.mp3', "Weekend Heroes - Ne'x (Andrea Bertolini Remix)_www.dj-case.com.mp3", "Weekend Heroes - Ne'x (Original Mix)_www.dj-case.com.mp3", 'Weekend Heroes - Sleep Late (Original Mix)_www.dj-case.com.mp3', 'Whiteside & JMS - Roof Is On Fire(Jorge Martin S & Whiteside Electro Jam Mix)_www.dj-case.com.mp3', 'Whizzkids ft. Inusa Dawuda - Rub-A-Dub Girl (Mattias & Stylus Robb Rmx)_www.dj-case.com.mp3', 'Will Bailey - Hit The Club (Calvertron Remix)_www.dj-case.com.mp3', 'Yoky - Off The Wall (Original Mix)_www.dj-case.com.mp3', 'Yolanda Be Cool & DCUP - We No Speak Americano (Original Mix)_www.dj-case.com.mp3', "Yves Larock & Shermanology - I don't Know (RMX)_www.dj-case.com.mp3", 'Zoe Badwi - Release Me (Niels Van Gogh Remix)_www.dj-case.com.mp3'];




var album2BPMList = [130.000, 128.000, 128.00, 128.000, 128.000, 
                       128.000, 128.000, 128.000, 128.80, 128.000, 
                       129.000, 128.00, 130.00, 128.000, 128.00, 126.000, 
                       127.000, 127.00, 127.00, 130.00, 125.000,
                      128.000, 128.00, 128.000, 130.00, 130.000,
                      130.000, 128.000, 128.00, 127.000, 128.00,
                      127.00, 130.000, 128.000, 128.00, 128.00,
                      128.000, 127.00, 130.000, 128.000, 127.00,
                      126.00, 128.00, 128.000, 128.00, 138.00,
                      128.000, 128.000, 128.000, 126.000, 126.000,
                      62.540*2, 130.000, 128.00, 130.000, 128.000,
                      126.000, 128.000, 128.000, 130.000, 128.000,
                      128.00, 130.000, 128.000, 128.00, 129.000,
                      126.000, 128.000, 128.000, 128.00, 128.00,
                      128.00, 127.00, 128.00, 129.00, 127.00,
                      128.000, 128.00, 128.00, 128.00, 128.00,
                      127.000, 128.00, 128.00, 126.00, 128.00,
                      128.00, 128.00, 128.00, 127.00, 125.00,
                      127.00, 129.00, 128.00, 126.00, 128.00,
                      128.00, 130.00, 128.00, 130.00, 126.00,
                      128.00, 135.00, 128.00, 128.00, 128.00,
                      128.00, 125.00, 128.00, 128.00, 128.00,
                      128.00, 127.00, 128.00, 128.00, 128.00, 
                       128.00,
                      130.00, 120.00, 125.00, 128.00, 128.00,
                      128.00, 128.00, 126.00, 128.00, 128.00,
                      130.00, 129.00, 127.00, 128.00, 124.00,
                      128.00, 120.00, 128.00, 128.00, 129.00,
                      128.00, 128.00, 126.00, 128.00, 128.00,
                      128.00, 128.00, 125.00, 128.00, 128.00,
                      ];
var album2BPMListp1 = album2BPMList.slice(0,75);
var album2BPMListp2 = album2BPMList.slice(75);

var album3TrackList = ['01 Mind Games.mp3', '02 All of Me (feat. Logic & ROZES).mp3', '03 People (feat. Jorja Smith & Dre I.mp3', '04 Cheese (Original Mix).mp3', '05 Everything Changed (Official Wish.mp3', '06 Stay A While (Ummet Ozcan Remix).mp3', '07 24_7 (feat. MC Daxta).mp3', "08 Dancin' (Extended Mix).mp3", '09 Emelie (feat. Buster Moe).mp3', '10 Bass Cannon (Awoltalk Remix).mp3', '11 No Holding Back (Original Mix).mp3', '12 I Choose You (Original Mix).mp3', '13 Rolling Dice (feat. Ella Vos & Jo.mp3', '14 End Of The World.mp3', '15 Buck.mp3', '16 Cruel World.mp3', '17 For You (feat. Park Avenue).mp3', '18 The Roads We Take.mp3', '19 Dive (Original Mix).mp3', '20 Follow Me (Original Mix) (feat. J.mp3', '21 Closer (Gill Chang Remix).mp3', '22 Out Of My System (Galantis Remix).mp3'];

var album3BPMList = [143.0, 142.0, 135.0, 80.0, 150.0, 140.0,
                    87.0, 127.0, 120.0, 150.0, 130.0,
                    150.0, 118.0, 122.0, 80.0, 80.0,
                    155.0, 133.0, 92.0, 122.0, 99.0, 
                     124.0];

var file1 = 'static/Wave_Racer_Streamers.mp3';
var file2 = 'static/Hi_Tom_Summer_Plants.mp3';
var file3 = 'static/Hoodboi_By_Ur_Side.mp3',
    file4 = 'static/Giraffage_Be_With_You.mp3',
    file5 = 'static/Wave_Racer_Flash_Drive.mp3',
    file6 = 'static/OZZIE_YOUSHOULDKNOW.mp3',
    file7 = 'static/OZZIE_XO.mp3',
    file8 = 'static/SRC_Lemsip.mp3',
    file9 = 'static/Joker_Cruel_Intentions.mp3',
    file10 = 'static/Bear_Face_Taste_My_Sad.mp3',
    file11 = 'static/LWiz_Girl_From_Codeine_City.mp3',
    file12 = 'static/Village_Dive.mp3',
    hash,
    token = null,
    fileArray = [file1,file2,file3,file4,file5,file6,file7,file8,file9,file10,file11,file12],
    fileArrayAnswers = [140,142,140,140,134,140,122,140,140,142,141,140];


/*************************/

// CREATE THE "HIDDEN" WAVESURFER FOR BPM ANALYSIS
var hiddenWS,
    BPMTestResults = [];
    
var hiddenWS = WaveSurfer.create({
    container: '#hiddenDiv',
    normalize: true,
    scrollParent: true
});



// THESE VARIABLES DEFINE WHETHER A DECK IS RUNNING
var leftIsRunning = false,
    rightIsRunning = false,
    hiddenIsRunning = false;

// SET EVENT HANDLERS FOR PLAY/PAUSE BUTTONS
$("#playButton").on("click", playPauseLeft)
$("#playButtonR").on("click", playPauseRight)
$("#hiddenPlayPause").on("click", playPauseHidden)



function play(ws) {
    // START THE DECK
    ws.play()
}


function playPauseLeft() {
    // PLAY/PAUSE THE LEFT DECK
    if (leftIsRunning) {
        leftIsRunning = false
        stop(wavesurferLeft)
    } else {
        leftIsRunning = true
        play(wavesurferLeft)
    }
}

function playPauseRight() {
    // PLAY/PAUSE THE RIGHT DECK
    if (rightIsRunning) {
        rightIsRunning = false
        stop(wavesurferRight)
    } else {
        rightIsRunning = true
        play(wavesurferRight)
    }
}


function playPauseHidden() {
    // PLAY/PAUSE THE RIGHT DECK
    if (hiddenIsRunning) {
        hiddenIsRunning = false
        stop(hiddenWS)
    } else {
        hiddenIsRunning = true
        play(hiddenWS)
    }
}

function stop(ws) {
    // STOP THE DECK
    ws.pause()
}


// CREATE LEFT DECK WAVESURFER INSTANCE
var wavesurferLeft = WaveSurfer.create({
    container: '#waveformL',
});
console.log("CREATED WS INSTANCE");
console.log(wavesurferLeft)
// LOAD INITIAL AUDIO TRACK
wavesurferLeft.load(file1)

// DEFINE LEFT DECK VARIABLES
var gainNodeL,
    analyserL,
    dataArrayL,
    canvasL = document.querySelector('#canvasLeft'),
    canvasCtxL = canvasL.getContext("2d"),
    bufferLengthL,
    bufferL,
    RMS_ArrayL = [],
    rms_step = 2.5;


// CONNECT GAIN NODE
var contextL = wavesurferLeft.backend.ac
gainNodeL = contextL.createGain();
console.log(gainNodeL);
wavesurferLeft.backend.setFilter(gainNodeL);


// CREATE RIGHT DECK WAVESURFER INSTANCE
var wavesurferRight = WaveSurfer.create({
    container: '#waveformR',
});

// DEFINE RIGHT DECK VARIABLES
var gainNodeR,
    analyserR,
    dataArrayR,
    canvasR = document.querySelector('#canvasRight'),
    canvasCtxR = canvasR.getContext("2d"),
    bufferLengthR,
    bufferR,
    RMS_ArrayR = [];

// LOAD INITIAL TRACK INTO DECK 2
wavesurferRight.load(file2)

// CONNECT GAIN NODE
var contextR = wavesurferRight.backend.ac
gainNodeR = contextR.createGain();
console.log(gainNodeR);
wavesurferRight.backend.setFilter(gainNodeR);



function draw() {
    // DRAW THE OSCILLOSCOPE

    drawVisual = requestAnimationFrame(draw);

    analyser.getByteTimeDomainData(dataArrayL);
    canvasCtx = canvasCtxL

    canvasCtx.fillStyle = 'rgb(200, 200, 200)';
    canvasCtx.fillRect(0, 0, canvasL.width, canvasL.height);

    canvasCtx.lineWidth = 2;
    canvasCtx.strokeStyle = 'rgb(0, 0, 0)';

    canvasCtx.beginPath();

    var sliceWidth = canvasL.width * 1.0 / bufferLengthL;
    var x = 0;

    for(var i = 0; i < bufferLengthL; i++) {

        var v = dataArrayL[i] / 128.0;
        var y = v * canvasL.height/2;

        if(i === 0) {
          canvasCtx.moveTo(x, y);
        } else {
          canvasCtx.lineTo(x, y);
        }

        x += sliceWidth;
    }

    canvasCtx.lineTo(canvasL.width, canvasL.height/2);
    canvasCtx.stroke();
};


// FUNCTION TO CALL ONCE THE WAVESURFER TRACK HAS BEEN LOADED
function isReady(ws, gainNode, bufferLength, dataArray, buffer, rms_array) {
    // HELPER FUNCTION FOR DECK-IS-READY
    var context = ws.backend.ac
    console.log(ws.backend)
    console.log(context)
    /*
    // CONNECT GAIN NODE
    gainNode = context.createGain();
    console.log(gainNode)
    console.log(ws.backend.source)
    ws.backend.setFilter(gainNode)
    */
    // CONNECT ANALYSER
    analyser = context.createAnalyser();
    gainNode.connect(analyser)
    bufferLength = analyser.frequencyBinCount;
    console.log(bufferLength);
    
    // FEED THE AUDIO DATA INTO THE BUFFER
    dataArray = new Uint8Array(bufferLength);
    analyser.getByteTimeDomainData(dataArray);
    buffer = new Uint8Array(analyser.fftSize);
    console.log(bufferLength)

    // GET AN AVERAGE RMS ARRAY FOR GRAPHING PURPOSES
    getRMS2(ws, rms_array, 2.5 * 44100);
    // DRAW THE LOUDNESS GRAPH
    if (ws === wavesurferLeft) {
        // draw()
        drawGraphL();
    } else {
        drawGraphR();
    }
}

wavesurferLeft.on('ready', function () {
    // ACTION ONCE THE TRACK IS LOADED INTO WAVESURFER INSTANCE
    console.log("Wavesurfer LEFT")
    console.log(wavesurferLeft)
    isReady(wavesurferLeft, gainNodeL, bufferLengthL, dataArrayL, bufferL, RMS_ArrayL)
});

wavesurferRight.on('ready', function () {
    // ACTION ONCE THE TRACK IS LOADED INTO WAVESURFER INSTANCE
    console.log("Wavesurfer RIGHT")
    console.log(wavesurferRight)
    isReady(wavesurferRight, gainNodeR, bufferLengthR, dataArrayR, bufferR, RMS_ArrayR)
});


function getRMS(ws, rms_array) {
    // CALCULATE THE RMS AT EACH NMS_STEP (SECONDS) INTERVAL
    var rms1 = 0;
    var rms = 0;
    var rms2 = 0;
    // GET THE L AND R CHANNEL
    var c = ws.backend.source.buffer.getChannelData(0);
    var d = ws.backend.source.buffer.getChannelData(1);

    // GO THROUGH THE CHANNEL FRAMES AND GET THE RMS OF THE AVERAGE 
    // LEVEL BETWEEN THE TWO CHANNELS
    for (var i=0; i < c.length; i++) {
        // AVERAGE THE TWO CHANNELS
        rms += c[i] * c[i];
        rms2 += d[i] * d[i];
        rms = (rms + rms2) / 2;
        if (i % (44100 * rms_step) == 0) {
            // RECORD THE RMS EVERY (RMS_STEP * SAMPLERATE) FRAMES
            rms /= ws.backend.source.buffer.length;
            rms = Math.sqrt(rms);
            // PUSH THE RMS IN DECIBELS ONTO THE RMS_ARRAY
            rms_array.push( [i / 44100, 20*Math.log10(Math.abs(rms))] )
            rms = 0
        }
    }
}

function getRMS2(ws, rms_array, rms_step1) {
    // CALCULATE THE RMS OF EACH RMS_STEP (FRAMES) INTERVAL
    console.log("getRMS2");
    // ROUND THE INTERVAL TO A WHOLE NUMBER
    rms_step1 = Math.round(rms_step1);
    var rms = 0;
    // GET THE L AND R CHANNEL DATA
    var c = ws.backend.source.buffer.getChannelData(0);
    var d = ws.backend.source.buffer.getChannelData(1);

    for (var i=0; i < c.length; i++) {
        // GO THROUGH THE CHANNEL DATA AND GET THE RMS OF 
        // AVERAGE OF THE TWO SIGNALS EVERY RMS_STEP1 FRAMES
        rms += ((c[i]+d[i])/2) * ((c[i]+d[i])/2)
        if (i % rms_step1 === 0) {
            // rms /= ws.backend.source.buffer.length;
            rms /=rms_step1;
            rms = Math.sqrt(rms);
            // CONVERT THE RESULT TO DECIBELS AND PUSH TO THE ARRAY,
            // ALONG WITH THE SECONDS AT WHICH THE RMS IS TAKEN
            rms_array.push( [i / 44100, 20*Math.log10(Math.abs(rms))] )
            rms = 0;
        }
    }
    console.log("RMS_ARRAY ", rms_array)
    return rms_array;
}

function changeVolumeLeft() {
    // THE LEFT VOLUME SLIDER
    console.log("CHANGE")
    var sliderValue = document.getElementById("VolSliderL").value
    console.log(sliderValue)
    gainNodeL.gain.value = sliderValue / 100
}

function changeVolumeRight() {
    // THE RIGHT VOLUME SLIDER
    console.log("CHANGE")
    var sliderValue = document.getElementById("VolSliderR").value
    console.log(sliderValue)
    gainNodeR.gain.value = sliderValue / 100
}

function xFade() {
    var xFadeValue = (document.querySelector("#xFader").value-50) / 50.0;
    console.log(xFadeValue);
    var leftVal = Math.sqrt(0.5 * (1 - xFadeValue));
    var rightVal = Math.sqrt(0.5 * (1 + xFadeValue));
    console.log(leftVal, rightVal);
    gainNodeL.gain.value = leftVal;
    gainNodeR.gain.value = rightVal;
}

$('.form-group').on('click','input[type=radio]',function() {
    $(this).closest('.form-group').find('.radio-inline, .radio').removeClass('checked');
    $(this).closest('.radio-inline, .radio').addClass('checked');
});

document.querySelector("#VolSliderL").addEventListener("change", changeVolumeLeft);
document.querySelector("#VolSliderR").addEventListener("change", changeVolumeRight);
document.querySelector("#xFader").addEventListener("change", xFade);

document.querySelector("#option-0").addEventListener("click", function() {clearGraphLeft(); wavesurferLeft.load(file1);})
document.querySelector("#option-1").addEventListener("click", function() {clearGraphLeft(); wavesurferLeft.load(file2);})
document.querySelector("#option-2").addEventListener("click", function() {clearGraphLeft(); wavesurferLeft.load(file3);})

document.querySelector("#option-0R").addEventListener("click", function() {clearGraphRight(); wavesurferRight.load(file1);})
document.querySelector("#option-1R").addEventListener("click", function() {clearGraphRight(); wavesurferRight.load(file2);})
document.querySelector("#option-2R").addEventListener("click", function() {clearGraphRight(); wavesurferRight.load(file3);})

function clearGraphLeft() {
    RMS_ArrayL = [];
    var canvas = document.querySelector("#graphLeft")
    canvas.width = canvas.width
}

function clearGraphRight() {
    RMS_ArrayR = [];
    var canvas = document.querySelector("#graphRight")
    canvas.width = canvas.width
}



function drawGraphL() {
    // Wrapper for drawing the left graph
    d = requestAnimationFrame(drawGraphL)
    drawGraph(wavesurferLeft, document.querySelector("#graphLeft"), RMS_ArrayL)
}

function drawGraphR() {
    // Wrapper for drawing the left graph
    d = requestAnimationFrame(drawGraphR)
    drawGraph(wavesurferRight, document.querySelector("#graphRight"), RMS_ArrayR)
}


function drawGraph(ws, canvas, rms_array) {
    // var canvas = document.getElementById("graphLeft");
    var context = canvas.getContext("2d");
    
    for (var x = 0.5; x < canvas.width; x += canvas.width / (ws.backend.buffer.duration / rms_step) ) {
        context.moveTo(x, 0);
        context.lineTo(x, canvas.height);
    }
    
    context.strokeStyle = "#eee";
    context.stroke();
    
    context.beginPath();
    for (var i=0; i<rms_array.length; i++) {
        var rms_pair = rms_array[i]
        var scale = canvas.width / ws.backend.buffer.duration
        if (i == 0) {
            context.moveTo(scale * rms_pair[0], rms_pair[1]*-1)
        } else {
            context.lineTo(scale * rms_pair[0], rms_pair[1]*-1)
        }
    }
    context.strokeStyle = "#000";
    context.stroke();
    
    context.beginPath();
    var currentTime = ws.backend.getCurrentTime();
    
    context.moveTo(currentTime * scale, 0);
    context.lineTo(currentTime * scale, canvas.height);
    
    context.stroke()
    
}


/*
play.onclick = function() {
  getData();
  source.start(0);
  play.setAttribute('disabled', 'disabled');
  playbackControl.removeAttribute('disabled');
  loopstartControl.removeAttribute('disabled');
  loopendControl.removeAttribute('disabled');
}

stop.onclick = function() {
  source.stop(0);
  play.removeAttribute('disabled');
  playbackControl.setAttribute('disabled', 'disabled');
  loopstartControl.setAttribute('disabled', 'disabled');
  loopendControl.setAttribute('disabled', 'disabled');
}

playbackControl.oninput = function() {
  source.playbackRate.value = playbackControl.value;
  playbackValue.innerHTML = playbackControl.value;
}

loopstartControl.oninput = function() {
  source.loopStart = loopstartControl.value;
  loopstartValue.innerHTML = loopstartControl.value;
}

loopendControl.oninput = function() {
  source.loopEnd = loopendControl.value;
  loopendValue.innerHTML = loopendControl.value;
}

*/
// dump script to pre element

// pre.innerHTML = myScript.innerHTML;




/*
function playSample() {
    // FUNCTION TO PLAY A SAMPLE FROM THE TRACK (for testing)
    
    // Stereo
    var channels = 2;

    var frameCount = wavesurfer.backend.ac.sampleRate * 5.0;
    console.log(frameCount)
    
    var myArrayBuffer = wavesurfer.backend.ac.createBuffer(channels, frameCount, wavesurfer.backend.ac.sampleRate);
    console.log(myArrayBuffer)
    // console.log(floatArray)
    
    var rms = 0;
    
    // Get a sample from the middle of the track
    for (var ch = 0; ch < channels; ch++) {
        var nowBuffering = myArrayBuffer.getChannelData(ch);
        // var ca = new Float32Array;
        var c = wavesurfer.backend.source.buffer.getChannelData(ch);
        // var n = dataArray.getChannelData(ch);
        j = 44100 * Math.floor(wavesurfer.backend.source.buffer.duration/2)
        for (var i=0; i < frameCount; i++) {
            nowBuffering[i] = c[i + 3748500]
            // nowBuffering[i] = c[i+ j]
            
            rms += nowBuffering[i] * nowBuffering[i]
            
            if (i % 1000000 == 0) {
                console.log(i, rms)
            }
        }
        rms /= nowBuffering.length;
        rms = Math.sqrt(rms);
    }
    // 20*Math.log10(Math.abs(0.5))
    console.log("RMS ", rms, 20*Math.log10(Math.abs(rms)))
    
    
    // Calculate the RMS of each 5 second interval
    var rms2 = 0;
    var n = 0;
    var c = wavesurfer.backend.source.buffer.getChannelData(0);

    for (var i=0; i < wavesurfer.backend.source.buffer.length; i++) {
        rms2 += c[i] * c[i]
        if (i % (44100 * rms_step) == 0) {
            rms2 /= nowBuffering.length;
            rms2 = Math.sqrt(rms2);
            console.log("RMS2 ", n, i, 20*Math.log10(Math.abs(rms2)))
            RMS_Array.push( [i / 44100, 20*Math.log10(Math.abs(rms2))] )
            rms2 = 0
            n++
        }
    }
    
    // Get an AudioBufferSourceNode.
    // This is the AudioNode to use when we want to play an AudioBuffer
    var source = wavesurfer.backend.ac.createBufferSource();
    // set the buffer in the AudioBufferSourceNode
    source.buffer = myArrayBuffer;
    // connect the AudioBufferSourceNode to the
    // destination so we can hear the sound
    source.connect(gainNode);
    // start the source playing
    source.start();
    drawGraph()

}
*/

/*
// MY ATTEMPT TO EXTRACT AUDIO DATA FROM AN EXTERNAL URL
// DOESN'T WORK(?)
function getData() {
  source = audioCtx.createBufferSource();
  request = new XMLHttpRequest();

  request.open('GET', 'http://localhost/~JRap/AudioProject/sax.mp3', true);

  request.responseType = 'arraybuffer';


  request.onload = function() {
    var audioData = request.response;

    audioCtx.decodeAudioData(audioData, function(buffer) {
        myBuffer = buffer;
        songLength = buffer.duration;
        source.buffer = myBuffer;
        source.playbackRate.value = 1.0
        //source.playbackRate.value = playbackControl.value;
        source.connect(audioCtx.destination);
        //source.loop = true;

        // loopstartControl.setAttribute('max', Math.floor(songLength));
        // loopendControl.setAttribute('max', Math.floor(songLength));
      },

      function(e){"Error with decoding audio data" + e.err});

  }

  request.send();
}
*/





/* ************* */

// SPOTIFY AUTHENTICATION - WORKING BUT UNNECESSARY FOR NOW

/*
document.getElementById('login-button').addEventListener('click', function() {

    var client_id = '65fe5dec0aaa47e8ab365e51137a9ef9'; // Your client id
    var redirect_uri = 'http://localhost:3000/'; // Your redirect uri

    // var state = generateRandomString(16);

    // localStorage.setItem(stateKey, state);
    var scope = 'user-read-private user-read-email';

    var url = 'https://accounts.spotify.com/authorize';
    url += '?response_type=token';
    url += '&client_id=' + encodeURIComponent(client_id);
    //url += '&scope=' + encodeURIComponent(scope);
    url += '&redirect_uri=' + encodeURIComponent(redirect_uri);
    // url += '&state=' + encodeURIComponent(state);

    window.location = url;
    token = window.location.hash

    }, false);

// document.querySelector("#token-button").addEventListener('click', getToken, false)
*/

// THIS RETRIEVES AN ACCESS TOKEN UPON OPENING THE PAGE
/*
$(function() {
    getToken()
    if (token === null) {

        var client_id = '65fe5dec0aaa47e8ab365e51137a9ef9'; // Your client id
        var redirect_uri = 'http://localhost:3000/'; // Your redirect uri

        var url = 'https://accounts.spotify.com/authorize';
        url += '?response_type=token';
        url += '&client_id=' + encodeURIComponent(client_id);
        url += '&redirect_uri=' + encodeURIComponent(redirect_uri);

        window.location = url;
        // token = window.location.hash
    }
})
*/



function getToken() {
    var h = window.location.hash
    console.log("HASH!")
    console.log(h)
    if (h!="") {
        console.log(h.match(/^#[^&]*/))
        token = h.match(/^#[^&]*/)
    }
}


/*
function getSpotifyBPMLeft() {
    $.ajax({
        url: 'https://api.spotify.com/v1/me',
        headers: {
          'Authorization': 'Bearer ' + access_token
        },
        success: function(response) {
}
*/


// ********************************************** //
// BPM DETECTION

/* TO TEST THE BPM OF A TRACK, LOAD THE PAGE, AND TYPE 'getBPM(X)'
INTO THE CONSOLE, WHERE X = FILE1/FILE2/ETC. */

/*

Hoodboi_By_Ur_Side: 140,                :)
Wave_Racer_Streamers: 140,              X (132.5, 131, 129.5, 140)
Wave_Racer_Flash_Drive: 134,     
Giraffage_Be_With_You: 140,             :)
Hi_Tom_Summer_Plants: 142,              :)
Bear_Face_Taste_My_Sad: 142,     
LWiz_Girl_From_Codeine_City: 141,
Village_Dive: 140 ,
OZZIE_YOUSHOULDKNOW: 140                X (93.5, 140])

PARAMETERS:
- THRESHOLD         [0.9]
- NEIGHBORRANGE     [25]
- ROUNDING          [100]

*/

var threshold;

function getPeaksAtThreshold(ws) {
    // RETURNS AN ARRAY OF THE INDICES OF ALL THE PEAKS ABOVE THE THRESHOLD
    console.log("UP HERE");
    console.log(ws);
    var data1 = ws.backend.buffer.getChannelData(0);
    var data2 = ws.backend.buffer.getChannelData(0);
    
    
    threshold = 0.95;
    // var threshold = 0.95;
    
    
    do {
        var peaksArray = [];
        
        for(var i = 0; i < data1.length; i++) {
            var d = (data1[i]+data2[i])/2;
            if (d > threshold) {
              peaksArray.push(i);
              // Skip forward ~ 1/4s to get past this peak.
              i += 10000;
            }
            i++;
        }
        threshold -= 0.05;
        console.log("THRESHOLD NOW", threshold, peaksArray.length);
    } while (peaksArray.length < ws.backend.buffer.duration / 2);
    /*
    console.log("THRESHOLD NOW", threshold);
    for(var i = 0; i < data.length; i++) {
        if (data[i] > threshold) {
          peaksArray.push(i);
          // Skip forward ~ 1/4s to get past this peak.
          i += 10000;
        }
        i++;
    }
    */
    console.log("PEAKS ARRAY");
    //console.log(peaksArray);
    var canvasH = $("#hiddenContainer wave canvas")[0];
    var contextH = canvasH.getContext("2d");
    /*
    var scale = canvasH.width / hiddenWS.backend.buffer.length;
    for (var i=0; i< peaksArray.length; i++) {
        var x = peaksArray[i];
        var y = (x / hiddenWS.backend.buffer.length) * canvasH.width
        // console.log(i,peaksArray[i],i*scale);
        contextH.moveTo(y, 0);
        contextH.lineTo(y, canvasH.height);
        // Round the interval
        // peaksArray[i] = Math.floor(peaksArray[i]/100) * 100   
    }
    contextH.strokeStyle = "#000";
    contextH.stroke();
    */
    console.log(peaksArray);
    console.log(peaksArray.length);
    console.log("RETURNING")
    return peaksArray;
}

var confidence = 0;

function countIntervalsBetweenNearbyPeaks(peaks) {
    // RETURNS A LIST OF DICTS WHICH COUNT 
    // EACH INTERVAL BETWEEN NEARBY PEAKS AND HOW MANY TIMES IT APPEARS
    var intervalCounts = [];
    // NeighborRange = how many neighboring peaks to look at when counting
    var neighborRange = 5;
    peaks.forEach(function(peak, index) {
    for (var i = 1; i <= neighborRange; i++) {
        // FOR EACH PEAK, GET THE INTERVALS TO THE NEXT NEIGHBORRANGE PEAKS
        var interval = peaks[index + i] - peak;
        interval = intervalToBPM(interval, 44100);
        // ROUND THE INTERVAL DOWN A LITTLE IN ORDER TO GROUP
        // INTERVALS THAT ARE REALLY SIMILAR
        // interval = Math.floor(interval / 10) * 10;
        var foundInterval = intervalCounts.some(function(intervalCount) {
            if (intervalCount.interval === interval) {
                return intervalCount.count++;
            }
          });
          if (!foundInterval) {
                intervalCounts.push({
                    interval: interval,
                    count: 1
                });
            }
        }
    });
    // SORT THE RESULTS BY COUNT DESCENDING
    intervalCounts.sort(function(a,b) {return b.count - a.count})
    // confidence = intervalCounts[0].count - intervalCounts[1].count;
    return intervalCounts;
}



function intervalToBPM(interval, samplerate) {
    result = 60 / (interval / samplerate)
    while (result < 80) {
        result *= 2
    }
    while (result > 160) {
        result /= 2
    }
    // ROUND INTERVALS TO NEAREST 0.1
    return Math.round(result*10) / 10
}

function BPMToInterval(BPM, samplerate) {
    return (60 * samplerate) / BPM
}

// var hipass = hiddenWS.backend.ac.createBiquadFilter();
// hipass.type = "highpass";
// hipass.frequency.value = 40000;
// hiddenWS.backend.setFilter(hipass);

    
    
function getBPM(track) {
    // RETURN THE BPM OF THE TRACK WITH THE GIVEN TITLE
    /*
    var ws = WaveSurfer.create({
        container: '#hiddenDiv',
        // scrollParent: true
    });
    */
    var currentTrack = track
    // var currentTrack = 'static/Music/' + trackListArray.shift();
    var ws = hiddenWS;
    ws.unAll();
    ws.load(currentTrack);
    ws.on("ready", function() {
        var sr = ws.backend.buffer.sampleRate;
        console.log("NOW GETTING BPM FOR ", ws)
        var peaks = getPeaksAtThreshold(ws);
        console.log("GOT PEAKS BACK")
        var counts = countIntervalsBetweenNearbyPeaks(peaks);
        console.log(counts)
        var intervalGuess = counts[0].interval
        console.log("INTERVAL GUESS = ", intervalGuess)
        /*
        var result = 60 / (intervalGuess / ws.backend.buffer.sampleRate)
        // GET THE RESULT BETWEEN 80 AND 160 BY DOUBLING/HALVING
        while (result < 80) {
            result *= 2
        }
        while (result > 160) {
            result /= 2
        }
        // ROUND THE RESULT TO THE NEAREST 0.5
        result = Math.round(result*2) / 2
        */
        //var result = intervalToBPM(intervalGuess, ws.backend.buffer.sampleRate)
        // console.log("BPM GUESS = ", result)
        console.log("RUNNERS UP: ")
        //console.log(intervalToBPM(intervalGuess,ws.backend.buffer.sampleRate))
        /*
        console.log(60 / (counts[1].interval / ws.backend.buffer.sampleRate), 
                    60 / (counts[2].interval / ws.backend.buffer.sampleRate),
                    60 / (counts[3].interval / ws.backend.buffer.sampleRate));
              */
        console.log(counts[1].interval, counts[2].interval, counts[3].interval)
        /*
        console.log(intervalToBPM(counts[1].interval,sr), 
                    intervalToBPM(counts[2].interval,sr),
                    intervalToBPM(counts[3].interval,sr));
                    */
        return intervalGuess
    })
    // .push(result);
    // return result
}

var round = 1;


function getBPMTest() {
    // RETURN THE BPM OF THE TRACK WITH THE GIVEN TITLE
    /*
    var ws = WaveSurfer.create({
        container: '#hiddenDiv',
        // scrollParent: true
    });
    */
    testArray = fileArray
    console.log("TEST # ",round)
    console.log(testArray)
    var currentTrack = fileArray.shift();
    
    // var currentTrack = 'static/' + 'EpicHouse/' + testArray.shift();
    console.log(currentTrack);
    var ws = hiddenWS;
    // $("#hiddenWS").unbind("ready");
    // ws.on("ready", false);
    ws.unAll();
    ws.load(currentTrack);
    ws.on("ready", function() {
        var sr = ws.backend.buffer.sampleRate;
        console.log("NOW GETTING BPM FOR ", ws)
        var peaks = getPeaksAtThreshold(ws);
        var counts = countIntervalsBetweenNearbyPeaks(peaks);
        console.log(counts)
        var intervalGuess = counts[0].interval
        console.log("INTERVAL GUESS = ", intervalGuess)
        // var result = 60 / (intervalGuess / ws.backend.buffer.sampleRate)
        // GET THE RESULT BETWEEN 80 AND 160 BY DOUBLING/HALVING
        /*
        while (result < 80) {
            result *= 2
        }
        while (result > 160) {
            result /= 2
        }
        */
        // ROUND THE RESULT TO THE NEAREST 0.5
        // result = Math.round(result*2) / 2
        // console.log("BPM GUESS = ", result)
        console.log("RUNNERS UP: ")
        /*
        console.log(60 / (counts[1].interval / ws.backend.buffer.sampleRate), 
                    60 / (counts[2].interval / ws.backend.buffer.sampleRate),
                    60 / (counts[3].interval / ws.backend.buffer.sampleRate));
                    */
        console.log(counts[1].interval, 
                    counts[2].interval,
                    counts[2].interval);
        BPMTestResults.push(intervalGuess);
        console.log(BPMTestResults);
        if (testArray.length > 0) {
            round++;
            // $("#hiddenWS").unbind();
            // ws.on("ready", false);
            console.log("DOWN HERE");
            getBPMTest();
        } else{
            console.log("DONE TESTING!")
            console.log(compareResults(fileArrayAnswers))
            return compareResults(fileArrayAnswers)
        }
    })
    return;
    // .push(result);
    // return result
}

// var delay = 5000
// var n = 1

var missed = [];

function compareResults(correctAnswerArr) {
    // var correctAnswerArr = album3BPMList;
    var result = 0
    for (var i=0; i < BPMTestResults.length; i++) {
        if (BPMTestResults[i] === correctAnswerArr[i]) {
            result ++;
        } else {
            missed.push(i);
        }
    }
    return result;
}

var realFirstPeak;
var realInterval;
var realBeatGrid;

function getBeatArray(ws, bpm) {
    var peakArray = getPeaksAtThreshold(ws);
    // NOT SURE IF THIS VALUE SHOULD BE ROUNDED OR NOT
    var interval = Math.round(BPMToInterval(bpm, ws.backend.buffer.sampleRate));
    console.log(interval);
    
    var result = [];
    var topScore = 0;
    
    for (var i=0; i < 30; i++) {
        var firstPeak = peakArray[i];
        // console.log(i, firstPeak);
        var peakGrid = [];
        var peakGrid2 = [];
        var c = ws.backend.buffer.getChannelData(0);
        for (var j = firstPeak; j < ws.backend.buffer.length; j += interval) {
            peakGrid2.push(j)
            for (var k = -100; k < 100; k++) {
                if (peakArray.indexOf(Math.round(j+k)) > -1) {
                    peakGrid.push(j);
                    realInterval = interval;
                    break
                }
            }
        }
        if (peakGrid.length > topScore) {
            result = peakGrid2;
            realFirstPeak = firstPeak;
        }
    }
    
    for (var i = realFirstPeak - interval; i > 0; i -= interval) {
        result.unshift(i)
    }
    
    
    
    console.log(result);
    var canvasH = $("#hiddenContainer wave canvas")[0];
    var contextH = canvasH.getContext("2d");
    var scale = canvasH.width / hiddenWS.backend.buffer.length;
    for (var i=0; i< result.length; i++) {
        var x = result[i];
        var y = (x / hiddenWS.backend.buffer.length) * canvasH.width
        // console.log(i,peaksArray[i],i*scale);
        contextH.moveTo(y, 0);
        contextH.lineTo(y, canvasH.height);
        // Round the interval
        // peaksArray[i] = Math.floor(peaksArray[i]/100) * 100   
    }
    contextH.strokeStyle = "#000";
    contextH.stroke();
    console.log("REALFIRSTPEAK", realFirstPeak);
    contextH.beginPath();
    contextH.lineWidth = 5;
    contextH.moveTo((realFirstPeak / hiddenWS.backend.buffer.length)*canvasH.width, 0);
    contextH.lineTo((realFirstPeak / hiddenWS.backend.buffer.length)*canvasH.width, canvasH.height);
    // contextH.stroke();
    
    console.log(getAverageRMS(ws));
    realBeatGrid = result;
    return result
}

var N = 8;
var RMSAverages;
var RMSAveragesArray;
function getAverageRMS(ws) {
    // RETURNS A LIST OF THE AVERAGE RMS'S EVERY N BEATS
    // EACH ENTRY TELLS YOU THE AVERAGE RMS UP TO THE NEXT N BEATS
    console.log("getAverageRMS");
    var result = [];
    var rmsArr = [];
    // var n = 32
    console.log(realInterval,ws);
    var RMS = getRMS2(ws, rmsArr, realInterval);
    RMSAveragesArray = RMS;
    for (var i=0; i < rmsArr.length-N; i++) {
        // console.log("NOW AT ", i);
        var average = 0;
        for (var j=0; j < N; j++) {
            // console.log("step ",j)
            if (i+j < rmsArr.length) {
                // console.log(rmsArr[i+j][1]);
                average += rmsArr[i+j][1];
            } else {
                console.log("Last section");
                // console.log(average, n);
                average /= j;
                result.push([i * realInterval, average])
                // result.push(average);
                RMSAverages = result;
                return result;
            }
            
        }
        average /= N;
        // console.log(average, n);
        result.push([i * realInterval, average]);
    }
    RMSAverages = result;
    console.log(getDifferences(result));
    return result;
}

function getDifferences(arr) {
    // RETURNS A LIST OF THE DIFFERENCES BETWEEN THE RMS OF ONE 
    // N-BEAT SECTION AND ANOTHER
    console.log("GET DIFFERENCES");
    result = [];
    for (var i = N/2; i < arr.length-(N*2); i++) {
        result.push([i+N-1, Math.abs(arr[i][1]-arr[i+N][1]),
                    arr[i][1], arr[i+N][1]]);
    }
    console.log(result);
    return result;
}

function smoothArray(arr, shift) {
    result = 1000000000;
    var correctX = 0
    var costArray = []
    for (var i = 0; i < 4; i++) {
        var sumOfCosts = arr.map(function(a) {
            if ( (a-i)%4 === 3) {
                return 1
            } else {
                return (a-i)%4
            }
        }).reduce(function(a,b) {return a + b}, 0);
        console.log(sumOfCosts);
        costArray.push(sumOfCosts)
        if (sumOfCosts < result) {
            result = sumOfCosts
            console.log("NOW ", result, i);
            correctX = i;
        }
    }
    return arr.map(function(a) {
        return ( (Math.round( (a - correctX) / 4 )*4) + correctX);
    });
}

// console.log("SMOOTH ARRAY");
// console.log(smoothArray([1,5,10,12,16]));
// console.log(smoothArray([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20],3));

function groupByConsecutiveIntegers(arr) {
    console.log("GROUP BY CONSECUTIVE");
    console.log(arr);
    var result = [];
    for (var i=0; i < arr.length - 1; i++) {
        console.log(i, arr[i]);
        var temp = [];
        temp.push(arr[i]);
        while (i < arr.length-1 && Math.abs(arr[i+1][0] - arr[i][0]) === 1) {
            console.log(arr[i], arr[i+1]);
            i += 1;
            temp.push(arr[i])
        }
        console.log("TEMP ", temp);
        result.push(temp);
    }
    return result;
}

function getSegments() {
    return findSegments(getDifferences(RMSAverages));
}

// WORKING WELL:
// "static/EpicHouse/Ultra Nate - Free (Teo Moss & Danie Shems Remix)_www.dj-case.com.mp3"
// "static/EpicHouse/Zoe Badwi - Release Me (Niels Van Gogh Remix)_www.dj-case.com.mp3"
// "static/EpicHouse/Tv Rock ft Rudy - In The Air (Axwell Remix)_www.dj-case.com.mp3"
var loudestSeg = 0;
var segVolArray = [];
function findSegments(differencesArray) {
    differencesArray = differencesArray.sort(function(a,b) {return b[1] - a[1]}).slice(0,100).sort(function(a,b) {return b[0] - a[0]});
    console.log("DIFF", differencesArray);
    var grouped = groupByConsecutiveIntegers(differencesArray);
    console.log(grouped);
    
    for (var i = 0; i < grouped.length; i++) {
        grouped[i].sort(function(a,b) {return b[1] - a[1]})
    }
    console.log(grouped);
    result = grouped.map(function(a) {return a[0][0]})
    result = smoothArray(result);
    
    var loudest = 0;
    var arr1 = [];
    console.log(result);
    for (var i = 0; i < result.length; i++) {
        var r = (RMSAverages[result[i]][1] - RMSAverages[result[i]-N][1]);
        console.log("THIS ", i, result[i], r);
        segVolArray.push(r);
        console.log(r, loudestSeg);
        if (r !== Infinity && r > loudest) {
            console.log("r is now ", r);
            loudest = r;
            loudestSeg = result[i];
        }
    }
    console.log(result);
    result.sort(function(a,b) {
        console.log(a,b);
        var rA = RMSAverages[a][1] - RMSAverages[a-N][1];
        var rB = RMSAverages[b][1] - RMSAverages[b-N][1];
        return rB - rA;
    });
    console.log("SORTED ",result);
    
    
    var canvasH = $("#hiddenContainer wave canvas")[0];
    var contextH = canvasH.getContext("2d");
    var scale = canvasH.width / hiddenWS.backend.buffer.length;
    contextH.beginPath();
    contextH.lineWidth = 10;
    for (var i = 0; i < result.length; i++) {
        console.log(i,( (realBeatGrid[result[i]]) / hiddenWS.backend.buffer.length) * canvasH.width)
        contextH.moveTo( ( (realBeatGrid[result[i]]) / hiddenWS.backend.buffer.length) * canvasH.width, 0);
        contextH.lineTo( ( (realBeatGrid[result[i]]) / hiddenWS.backend.buffer.length) * canvasH.width, canvasH.height);
    }
    contextH.strokeStyle = "#090";
    console.log("STROKE");
    contextH.stroke();
    
    return result

}

var hiPass;
function hiBeats(ws, bpm) {
    
    /*
    hiPass = hiddenWS.backend.ac.createBiquadFilter();
    hiPass.type = "highpass";
    hiPass.frequency.value = 6000;
    hiddenWS.backend.setFilter(hiPass);
    */
    
    // Create offline context
    var buffer = hiddenWS.backend.buffer;
    var offlineContext = new OfflineAudioContext(1, buffer.length, buffer.sampleRate);

    // Create buffer source
    var source = offlineContext.createBufferSource();
    source.buffer = buffer;

    // Create filter
    var filter = offlineContext.createBiquadFilter();
    filter.type = "highpass";

    // Pipe the song into the filter, and the filter into the offline context
    source.connect(filter);
    filter.connect(offlineContext.destination);

    // Schedule the song to start playing at time:0
    source.start(0);

    // Render the song
    offlineContext.startRendering()

    // Act on the result
    offlineContext.oncomplete = function(e) {
      // Filtered buffer!
      var filteredBuffer = e.renderedBuffer;
        console.log("DOING THIS NOW");
        
        hiPassBeats = []
    
        hiddenWS.backend.buffer = filteredBuffer;
        var f = hiddenWS.backend.buffer.getChannelData(0);
        for (var i = 0; i < realBeatGrid.length; i++) {
            if (f[realBeatGrid[i]] > threshold) {
                hiPassBeats.push(realBeatGrid[i])
            }
        }
        
        var canvasH = $("#hiddenContainer wave canvas")[0];
        var contextH = canvasH.getContext("2d");
        var scale = canvasH.width / hiddenWS.backend.buffer.length;
        for (var i=0; i< hiPassBeats.length; i++) {
            var x = hiPassBeats[i];
            var y = (x / hiddenWS.backend.buffer.length) * canvasH.width
            // console.log(i,peaksArray[i],i*scale);
            contextH.moveTo(y, 0);
            contextH.lineTo(y, canvasH.height);
            // Round the interval
            // peaksArray[i] = Math.floor(peaksArray[i]/100) * 100   
        }
        contextH.strokeStyle = "#890";
        contextH.lineWidth = 3;
        contextH.stroke();
        
        return hiPassBeats;
        
    }
        
}



function goToBeat(ws, beatgrid, n) {
    ws.seekTo(beatgrid[n] / ws.backend.buffer.length);
}